<!DOCTYPE html>
<html>
<head>
    <title>Game Controller Client</title>
</head>
<body>
    <h1 id="clientStatus">GameShow Player Console</h1>
    <div id="status">Connecting...</div>
    <div id="messages">...</div>
    <div id="countdown"></div>
    <h2 id="questionText"></h2>
    <div id="answerButtons"></div>

    <hr> <div id="titleControls">
        <h3>Lower Third Control</h3>
        <button id="titleToggleButton" style="padding: 10px 20px; font-size: 16px;">Show Title</button>
    </div>

    <script src="js/signalr.min.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
            color: #333;
        }

        #status {
            font-size: 24px;
            margin-bottom: 20px;
        }

        #countdown {
            font-size: 96px;
            font-weight: bold;
            color: #d9534f; /* წითელი ფერი */
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        #answerButtons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            width: 80%;
            max-width: 800px;
        }

            #answerButtons button {
                font-size: 2rem;
                font-weight: bold;
                padding: 20px;
                border: 2px solid #5cb85c;
                border-radius: 8px;
                background-color: #f7f7f7;
                color: #333;
                cursor: pointer;
                transition: background-color 0.3s ease, transform 0.2s ease;
            }

                #answerButtons button:disabled {
                    background-color: #ddd;
                    cursor: not-allowed;
                    color: #666;
                    border-color: #ddd;
                    transform: none;
                }

        /* ახალი სტილები */
        #titleControls {
            margin-top: 20px;
            text-align: center;
        }

        #titleToggleButton {
            background-color: lightcoral;
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
    </style>


    <script>
        const statusDiv = document.getElementById('status');
        let countdownInterval;
        const questionTextElement = document.getElementById('questionText');
        const answerButtonsContainer = document.getElementById('answerButtons');

        // ახალი ღილაკის ელემენტი
        const titleToggleButton = document.getElementById('titleToggleButton');

        // მიიღეთ კლიენტის სახელი URL-ის პარამეტრიდან
        const urlParams = new URLSearchParams(window.location.search);
        let clientName = urlParams.get('name');

        // თუ სახელი არ არის მითითებული URL-ში, სთხოვეთ მომხმარებელს შეიყვანოს ის
        if (!clientName) {
            clientName = prompt("გთხოვთ შეიყვანოთ თქვენი სახელი:");
        }

        // დარწმუნდით, რომ სახელი არ არის ცარიელი
        if (!clientName) {
            clientName = `Player_${Math.floor(Math.random() * 1000)}`;
            console.warn("სახელი არ არის შეყვანილი, გამოყენებულია ნაგულისხმევი სახელი.");
        }


        const connection = new signalR.HubConnectionBuilder()
            .withUrl(`/gamehub?name=${encodeURIComponent(clientName)}`)
            .build();   


        // ღილაკზე დაჭერისას მოქმედება
        titleToggleButton.addEventListener('click', () => {
            let currentStatus = titleToggleButton.innerText === "Show Title" ? "show" : "hide";
            let curTitle = {
                Status: currentStatus,
                BreakingNews: "სპორტული ამბები",
                Headline: "საქართველო ევროპის ჩემპიონია",
                SecondLine: "ისტორიული გამარჯვება"
            };

            // Invoke-ის გამოძახება, როგორც თქვენს Win Forms აპლიკაციაში
            connection.invoke("CGSWToggleTitle", curTitle, currentStatus === "show")
                .then(() => {
                    if (currentStatus === "show") {
                        titleToggleButton.innerText = "Hide Title";
                        titleToggleButton.style.backgroundColor = "lightgreen";
                    } else {
                        titleToggleButton.innerText = "Show Title";
                        titleToggleButton.style.backgroundColor = "lightcoral";
                    }
                })
                .catch(err => console.error(err.toString()));
        });



        connection.onclose(error => {
            statusDiv.innerHTML = 'Disconnected';
            console.log("Connection closed.", error);
        });

        connection.onreconnecting(error => {
            statusDiv.innerHTML = 'Reconnecting...';
            console.log("Connection lost. Attempting to reconnect...", error);
        });

        connection.onreconnected(connectionId => {
            statusDiv.innerHTML = 'Reconnected!';
            console.log("Connection re-established. ConnectionId: ", connectionId);
        });


        connection.on("ReceiveCustomMessage", (senderName, message) => {
            const messagesDiv = document.getElementById('messages');
            const p = document.createElement('p');
            p.textContent = `${senderName}: ${message}`;
            messagesDiv.appendChild(p);
        });










        connection.on("UpdateRegistrationStatus", (registered, name, connectionID, clientType) => {
            if (registered) {
                statusDiv.innerHTML = connectionID + ' Connected, Registered!';
                clientStatus.innerHTML = clientType + ' ' + name;
                console.log("Connected, Registered!");
            } else {
                statusDiv.innerHTML = 'Connected, Not Registered!';
                console.log("Connected, Not Reegistered!");
            }
        });

        async function start() {
            try {
                await connection.start();
                statusDiv.innerHTML = 'Connected, waiting for registration!';

                console.log("Connection successful!");
            } catch (err) {
                statusDiv.innerHTML = 'Connection failed!';
                console.error(err);
                setTimeout(start, 5000);
            }
        };

        start();
    </script>
    <script>(function () { function c() { var b = a.contentDocument || a.contentWindow.document; if (b) { var d = b.createElement('script'); d.innerHTML = "window.__CF$cv$params={r:'989be0c9ff4be90c',t:'MTc1OTY1NjM5My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);"; b.getElementsByTagName('head')[0].appendChild(d) } } if (document.body) { var a = document.createElement('iframe'); a.height = 1; a.width = 1; a.style.position = 'absolute'; a.style.top = 0; a.style.left = 0; a.style.border = 'none'; a.style.visibility = 'hidden'; document.body.appendChild(a); if ('loading' !== document.readyState) c(); else if (window.addEventListener) document.addEventListener('DOMContentLoaded', c); else { var e = document.onreadystatechange || function () { }; document.onreadystatechange = function (b) { e(b); 'loading' !== document.readyState && (document.onreadystatechange = e, c()) } } } })();</script>
</body>
</html>